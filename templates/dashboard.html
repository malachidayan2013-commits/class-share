{% extends "base.html" %}
{% block content %}

<h2>
קבצים זמינים
{% if folder %}
 / {{ folder }}
{% endif %}
</h2>

<button onclick="toggleNew()">חדש</button>

<div id="newBox" style="display:none;">
    <form method="POST" action="/create" enctype="multipart/form-data">
        <select name="type" id="typeSelect" onchange="changeType()">
            <option value="folder">תיקייה</option>
            <option value="link">קישור</option>
            <option value="file">קובץ</option>
        </select>

        <input type="text" name="name" placeholder="שם" required>

        <div id="fileBox" style="display:none;">
            <input type="file" name="file">
        </div>

        <div id="linkBox" style="display:none;">
            <input type="text" name="url" placeholder="כתובת URL">
        </div>

        <button type="submit">צור</button>
    </form>
</div>

<hr>

{% for item in files %}
<div style="margin:10px 0;">

    <b>{{ item.name }}</b>

    {% if item.type == "file" %}
        <a href="/download/{{ item.filename }}">הורדה</a>
    {% endif %}

    {% if item.type == "link" %}
        <a href="{{ item.url }}" target="_blank">פתח קישור</a>
    {% endif %}

    {% if item.type == "folder" %}
        <a href="/dashboard?folder={{ item.name }}">פתח</a>
    {% endif %}

    <a href="/delete/{{ item.id }}">מחיקה</a>

    <form method="POST" action="/edit/{{ item.id }}" enctype="multipart/form-data">
        <input type="text" name="name" value="{{ item.name }}" required>

        {% if item.type == "link" %}
            <input type="text" name="url" value="{{ item.url }}">
        {% endif %}

        {% if item.type == "file" %}
            <input type="file" name="file">
        {% endif %}

        <button type="submit">ערוך</button>
    </form>

</div>
{% endfor %}

<script>
function toggleNew(){
    var box = document.getElementById("newBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
}

function changeType(){
    var type = document.getElementById("typeSelect").value;
    document.getElementById("fileBox").style.display = type === "file" ? "block" : "none";
    document.getElementById("linkBox").style.display = type === "link" ? "block" : "none";
}
</script>

{% endblock %}
